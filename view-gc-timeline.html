<html>

<head>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
	    google.charts.load("current", {packages:["timeline"]});
	    google.charts.setOnLoadCallback(onInitializeHandler);

	    var url = 'http://localhost:9999' ;
	    var container = null ;
	    var chart = null ;
	    var dataTable = null ;

	    function onInitializeHandler ( ) 
	    {
	        container = document.getElementById('div_chart');
	        chart = new google.visualization.Timeline(container);

	        dataTable = new google.visualization.DataTable();
	        dataTable.addColumn({ type: 'string', id: 'Position' });
	        dataTable.addColumn({ type: 'string', id: 'Name' });
	        dataTable.addColumn({ type: 'date',   id: 'Start' });
	        dataTable.addColumn({ type: 'date',   id: 'End' });
	    }

	    var jsonStream = null ;
            var start_time = new Date() ;
            var options = {
                   timeline: { colorByRowLabel: true }
                };

	    function onMessageHandler ( event ) 
	    {
		var elto_mon = JSON.parse(event.data); 
		var starting_time = new Date(0,0,0, 0,0,elto_mon.timestamp-elto_mon.timedelta,0) ;
		var ending_time   = new Date(0,0,0, 0,0,elto_mon.timestamp,0) ;

		dataTable.addRow([ elto_mon.type, elto_mon.usage.toString(10), starting_time, ending_time ]);
		chart.draw(dataTable, options) ;
	    }

	    function StartDrawing ( ) 
	    {
		jsonStream = new EventSource(url) ;
                jsonStream.addEventListener('error', function (e) { alert('Unable to connect: ' + url); }, false);
                jsonStream.addEventListener('message', onMessageHandler);
	    }

	    function StopDrawing ( ) 
	    {
                if (null != jsonStream)
                    jsonStream.close();
                jsonStream = null;
	    }
  </script>
</head>

<body>
  <table border="0" width="100%" cellpadding=10 cellspacing=10>
    <tr align=right>
      <td width="80%"> <input oninput="url=this.value;" type="text" id="input1" value="http://localhost:9999" size="50"> </td>
      <td width="5%">  <button onclick="StopDrawing()">Stop</button> </td>
      <td width="5%">  <button onclick="StartDrawing()">Start</button> </td>
    </tr>
    <tr>
      <td colspan="3" bgcolor="#E5E5E5">
      <div id="div_chart" style="height: 500px;"></div>
      </td>
    </tr>
  </table>
</body>

</html>
