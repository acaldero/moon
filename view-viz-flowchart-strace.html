<html>

<head>
    <script src="viz.js"></script>
    <script type="text/javascript">

	    var url = 'http://localhost:9999' ;
	    var container = null ;
	    var jsonStream = null ;

	    function onMessageHandler ( event ) 
	    {
		var elto_mon = "digraph { " + event.data + " }"; 
                container = document.getElementById('div_chart') ;
                container.innerHTML += Viz(elto_mon);
	    }

	    function StartDrawing ( ) 
	    {
                if (null != jsonStream)
                    return;

		jsonStream = new EventSource(url) ;
                jsonStream.addEventListener('error', 
                                            function (e) { 
                                                console.log('connection closed: ' + url); 
                                                StopDrawing(); 
                                            }, false) ;
                jsonStream.addEventListener('message', onMessageHandler) ;
	    }

	    function StopDrawing ( ) 
	    {
                if (null == jsonStream)
                    return;

                jsonStream.close() ;
                jsonStream = null ;
	    }

  </script>
</head>

<body>
  <table border="0" width="100%" cellpadding=10 cellspacing=10>
    <tr align=right>
      <td width="80%"> <input  oninput="url=this.value;" type="text" id="input1" value="http://localhost:9999" size="50"> </td>
      <td width="5%">  <button onclick="StopDrawing()">Stop</button> </td>
      <td width="5%">  <button onclick="StartDrawing()">Start</button> </td>
    </tr>
    <tr>
      <td colspan="3" bgcolor="#E8E8E8">
      <div id="div_chart" style="height: 500px;"></div>
      </td>
    </tr>
  </table>
</body>

</html>

